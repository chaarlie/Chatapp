<html >
<head>
	<title></title>

	 <meta name="generator" content="Bootply" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/ui-bootstrap-0.13.1-csp.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

    <link href="assets/css/angular-chart.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link href="assets/css/styles.css" rel="stylesheet">
    
	<!-- Thirdparty Dependencies -->
    <script src="assets/js/jquery.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/scripts.js"></script>
    <script src="assets/js/jquery-ui.min.js"></script>
    <script src="assets/js/socket.io-1.3.4.js"></script>
    <script src="assets/js/socket.io-stream.js"></script>
    <script src="assets/js/chart.js"></script>

    <!-- Angular  Libraries -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-router/0.2.15/angular-ui-router.min.js"></script>
    <script src="vendor/angular-chart.js"></script>  
    <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-animate.min.js"></script>
     <script src="vendor/ui-bootstrap-tpls-0.13.1.min.js"></script>
    
    <!-- App Services -->
    <script type="text/javascript" src="app/common/services/session-service.js"></script> 
    <script type="text/javascript" src="app/common/services/auth-service.js"></script>
    <script type="text/javascript" src="app/common/services/socket-service.js"></script> 
    
     <!-- App Modules -->
    <script src="app/chat.app.js"></script>
    <script type="text/javascript" src="app/login/login-controller.js"></script>
    <script type="text/javascript" src="app/home/home-controller.js"></script>
    <script type="text/javascript" src="app/dashboard/dashboard-controller.js"></script>


    <!-- App Directives -->
   <script type="text/javascript" src="app/dashboard/directives/chatbox-converter-directive.js"></script>
 
	<script type="text/javascript">
	
	var app =  angular.module('app', ['ui.router', 'chatApp.common', 'ui.bootstrap']);

	app.config(['$stateProvider', '$urlRouterProvider', function($stateProvider, $urlRouterProvider, $mdThemingProvider){
	    //$urlRouterProvider.otherwise('/home');
	    
	    $stateProvider
	        .state('login', {
	            url:'/login',
	            templateUrl:'app/login/login.html'
	        })
	        .state('home', {
	            url:'/home',
	            templateUrl:'app/home/home.html',
	        })
	        .state('dashboard', {
	            url:'/dashboard',
	            templateUrl:'app/dashboard/dashboard.html',
	            controller:'appController as dashboard'
	        })
	        .state('logoff', {
	            url:'/logoff',
	            templateUrl:'app/logoff/logoff.html',
	            onEnter: function($state, $timeout, $window){
	                $timeout(function(){
	                    $state.go('login'); 
	                }, 1500);
	                $timeout(function(){
	                   $window.location.reload();  
	                }, 2000)
	                
	            } 
	        });
	}])
  
        app.controller('appController', function($scope, Socket, MessageHandler){
        Socket.emit('userLogin', {username: 'test', age: ''});
    	Socket.on('msgFromServer', function (data) {
            alert('msgFromServer');
            $scope.chatboxes = MessageHandler.addEntry(data, false);
            console.log($scope.chatboxes);            
           // $scope.$emit('message', data);
        });
    });

    angular.module('app').service('MessageHandler', function(){
    	var chatboxes = {};
    
    	this.addEntry = function(data, byMe){
            chatboxes[data.from] = !chatboxes[data.from]?  [] : chatboxes[data.from];
            chatboxes[data.from].push({text: data.message, byMe: byMe});
            return chatboxes;
	    }
	});
 
	</script>
</head>
<body ng-app="app" ng-controller="appController">
	 <div class="container" >
      <header   role="navigation">
        <nav>
          <ul class="nav  nav-pills">
            <li class="active"><a href="#/home">Home</a></li>
            <li><a href="#/login">Login</a></li>
            <li><a href="#/register">Register</a></li>
             <li><a href="#/dashboard">Dashboard</a></li>
            <li><a href="#/about">About</a></li>
            <li><a href="#/contact">Contact</a></li>
          </ul>
        </nav>
     </header>

     <div ui-view></div>
     
    </div>

</body>


</html>